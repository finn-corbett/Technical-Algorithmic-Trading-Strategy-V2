# Technical Algorithmic Trading Strategy V2

A stock trading algorithm, backtested for 5 years from Sep 1 2017 to Sep 1 2022. This algorithm has been developed to evaluate the ability to use a large neural network for predicting stock movements using technical indicators.

As of posting this report, I am a 4th year Meng Aerospace Engineering student. I began this project to take on a challenging new task which is outside my area of expertise, I have taught myself to code using Python and have conducted my own research to gain the skills necessary to complete this.

This graph compares the value of a portfolio managed by the trading algorithm against using the 'Buy and Hold' strategy for the same stocks, and a 'Buy and Hold' strategy applied to the S&P500 (SPY). Each portfolio started the 5 year period with Â£100,000. To briefly summarise the results, the trading strategy is able to choose performant stocks, which by trading them based on price movements can maintain similar profitability with greatly reduced volatility/risk.
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/Portfolio%26SPY.png" alt="drawing" width="750"/>
### Table of Contents

* [About](#about)
* [Machine Learning Signal Generator](#machine-learning)
   1. [Overview](#ml-overview)
   2. [Model Parameters](#ml-parameters)
* [Features](#features)
   1. [Data Collection](#data-collection)
   2. [Stock Selection](#stock-selection)
   3. [Indicators](#indicators)
   4. [Portfolio Allocation](#portfolio-allocation)
* [Performance](#performance)
* [Conclusion](#conclusion)

### About <a name="about"></a>

This algorithm trades 10 different stocks on a daily basis, using 14 technical indicators to compute buy and sell signals for a selection of 10 different stocks. The trading signals are generated by a large neural network, which learns to predict the price change for the next close. It has been developed using historical stock pricing data from the Alpaca-py SDK. 

There is no live implimentation for this strategy, the 'Technical Algorithmic Trading Strategy V2.py' backtests the strategy for 5 years, outputting a 'performance.CSV' which can be analysed using 'performance_eval.py'. In order to use the backtest script, you must create an account with alpaca to get keys for their historical data API. The 'indicators.py' file contains functions used to calculate technical indicators.

# Machine Learning Signal Generator <a name="machine-learning"></a>
### Overview <a name="ml-overview"></a>

The algorithm creates a neural network that uses technical indicators as inputs, with which it predicts the percentage change in stock value for the next day. The neural network is run for each stock separately. For each simulated trading day in the backtest, technical indicators are calculated using the closing price, the neural network then produces a prediction for each stock. After predictions are made, the neural network is trained with the correct percentage change for the given inputs. This sequence ensures that the neural network is not exposed to any 'future data' in the backtest.  

This learning method is comparable to online learning, with data being used to train the network each day once it is available. Whilst it is impossible to buy and sell stocks at the closing price, as it is a 'past event' once the data is gathered, the speed of the algorithm would enable a near-closing-price to be gathered and processed within a short period of the daily stock market close. The change in stock value in the last small fraction of the day is neglected, and the closing price is used for indicator calculation and buy/sell orders for ease of programming.

### Model Parameters <a name="ml-parameters"></a>

CREATE TABLE OF PARAMETERS

# Features <a name="features"></a>
### Data Collection <a name="data-collection"></a>

Stock pricing data is collected using the Alpaca-py SDK, 5 years of historical daily ticker data is collected for each stock. This data consists of daily close prices for each stock, which this algorithm computes indicators and buy/sell positions from.

### Stock Selection <a name="stock-selection"></a>

Stocks are selected manually, with 10 large cap stocks being selected. Stocks were selected using the historical stock screener from ChartMills, the use of screening based on historical metrics eliminates bias in the stock selection process. This means that the algorithmic trading strategy presented in this report can be reliably compared to alternative investments.

The 10 stocks with the largest market capitalisation, within the IEX exchange, that meet these requirements are selected:

* free float > 20%
* EPS        > 0
* P/E        < 20 AND > 0
* P/S        < 14

The resulting stocks selected are:  

AAPL - Apple Inc  
BRK.B - Berkshire Hathaway Inc Class B  
NEE - NextEra Energy Inc  
JPM - JPMorgan Chase & Co  
T - AT&T Inc.  
PG - Procter & Gamble Co  
WMT - Walmart Inc  
VZ - Verizon Communications Inc.  
WFC - Wells Fargo & Co  
BAC - Bank of America Corp  

### Indicators <a name="indicators"></a>

The programme calculates 7 different technical indicators for configured periods (e.g. the 7 or 14 day simple moving average). Configuration can enable multiple periods for the same technical indicators to be used as inputs to the neural network (both the 7 and 14 day simple moving average can be used as inputs). By default, the programme has 14 inputs for the neural network which are used for this backtest:

* 7 and 40 day Relative Strength Index (RSI)
* 10 and 20 day Simple Moving Average (SMA)
* 10 and 20 day Weighted Moving Average (WMA)
* 10 and 20 day Exponential Moving Average (EMA)
* 20-10 day EMA Moving Average Convergence/Divergence (MACD) with 5 day EMA signal line
* 40-20 day EMA MACD with 10 day EMA signal line
* 10 and 20 day Rate Of Change (ROC)
* 14 and 30 day Commodity Channel Indices (CCI)
* 14 and 30 day Larry William's R (R)
* 7 and 21 day Chande Momentum Indicator

### Portfolio Allocation <a name="portfolio-allocation"></a>

$10000 is allocated to each of the 10 stocks, and any losses or gains are applied to this value, so that underperforming stocks take up a smaller portion of the portfolio, whilst overperforming stocks take up a larger portion. Any buy or sell signal sells and buys a stock with all of the money available to use for that stock. When buying and selling stocks, zero fees are assumed and dividends are not accounted for.

### Performance <a name="performance"></a>

This algorithm was able to produce a 55.24% return over a 5 year period, with an annualised daily return standard deviation of 9.88%.  
A buy and hold strategy for the same 10 stocks yielded 56.67% over the same period, with an annualised daily return standard deviation of 19.46%.  
Investing in SPY yielded 59.41%, with an annualised daily return standard deviation of 20.23%  
  
Sharpe ratios for the 3 investment strategies are:
* Algorithm    -     0.783
* Buy and Hold -     0.465
* SPY          -     0.446

The sharpe ratios are calculated with a risk free rate of 1.809%, the yield of the US 5 year treasury bond on Sep 1 2017.

These performance results indicate the the algorithmic trading strategy is able to reduce the risk compared to alternative investing strategies, such that the risk-adjusted returns are significantly greater whilst maintaining a similar level of profitability. The SPY is a widely used passive investing strategy, which is often implimented as a benchmark due to its historic performance and passive nature. These results indicate the algorithmic trading strategy being preferable to passive investing with the SPY, and being able to be applied to investment portfolios of large companies to reduce risk.
### Performance Charts
### AAPL
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/AAPL.png" alt="drawing" width="750"/> 

### BRK.B
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/BRK-B.png" alt="drawing" width="750"/> 

### NEE
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/NEE.png" alt="drawing" width="750"/>  

### JPM
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/JPM.png" alt="drawing" width="750"/>  

### T
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/T.png" alt="drawing" width="750"/>  

### PG
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/PG.png" alt="drawing" width="750"/>  

### WMT
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/WMT.png" alt="drawing" width="750"/>  

### VZ
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/VZ.png" alt="drawing" width="750"/>  

### WFC
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/WFC.png" alt="drawing" width="750"/>  

### BAC
<img src="https://github.com/finn-corbett/Technical-Algorithmic-Trading-Strategy-V2/blob/main/Images/BAC.png" alt="drawing" width="750"/> 


### Conclusion <a name="conclusion"></a>

The trading strategy is able to produce steady returns with preferable risk characteristics through a reduction in portfolio volatility. It can be seen across the various performance graphs that the strategy is capable of preventing large losses, such as that of the market crash caused by COVID-19. This trading strategy is recommended for passive investors.

The main concerns with this strategy and algorithm are:
* stop losses are not yet implimented, meaning that the algorithm may lose excessive amounts of money to large crashes.
* algorithm must wait 30 days to calculate indicators properly, resulting in 30 days downtime when it is initiated

Future versions should include:
* automated stock selection
* more advanced and dynamic portfolio allocation
